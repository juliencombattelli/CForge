# Test-specific variables.
set(CFORGE_UNIT_CURRENT_TEST_ID @CFORGE_UNIT_CURRENT_TEST_ID@)
set(CFORGE_UNIT_CURRENT_TEST_SCRIPT @CFORGE_UNIT_CURRENT_TEST_SCRIPT@)
set(CFORGE_UNIT_CURRENT_TEST_BINARY_DIR @CFORGE_UNIT_CURRENT_TEST_BINARY_DIR@)
set(TEST_SHALL_FAIL @ARG_SHALL_FAIL@)
set(TEST_PASS_REGEX "@ARG_PASS_REGEX@")
set(TEST_FAIL_REGEX "@ARG_FAIL_REGEX@")

add_test(
    NAME "${CFORGE_UNIT_CURRENT_TEST_ID}"
    COMMAND ${CMAKE_COMMAND}
        -C "${CFORGE_UNIT_CURRENT_TEST_BINARY_DIR}/ContextCache.cmake"
        -S "${CFORGE_UNIT_CURRENT_TEST_BINARY_DIR}"
        -B "${CFORGE_UNIT_CURRENT_TEST_BINARY_DIR}/build"
)
if(TEST_SHALL_FAIL)
    set_property(
        TEST "${CFORGE_UNIT_CURRENT_TEST_ID}"
        PROPERTY WILL_FAIL TRUE
    )
endif()
if(TEST_PASS_REGEX)
    set_property(
        TEST "${CFORGE_UNIT_CURRENT_TEST_ID}"
        PROPERTY PASS_REGULAR_EXPRESSION "${TEST_PASS_REGEX}"
    )
endif()
if(TEST_FAIL_REGEX)
    set_property(
        TEST "${CFORGE_UNIT_CURRENT_TEST_ID}"
        PROPERTY FAIL_REGULAR_EXPRESSION "${TEST_FAIL_REGEX}"
    )
endif()
